# 리소스 요구사항 (k3s)

## 현재 구성

### 스펙

- **인스턴스 타입**: t3.small
- **vCPU**: 2개
- **메모리**: 2GB
- **컨테이너 오케스트레이션**: k3s (경량 Kubernetes)
- **컨테이너 런타임**: Podman (daemonless)

## 메모리 사용량 분석 (k3s)

### 1. k3s 시스템 컴포넌트

| 컴포넌트                | k3s 메모리 | 설명                         |
| ----------------------- | ---------- | ---------------------------- |
| k3s (통합)              | ~300-400MB | 모든 컴포넌트 통합 (etcd 포함) |
| kube-proxy              | ~50MB      | 네트워크 프록시              |
| CoreDNS                 | ~50MB      | DNS 서버                     |
| Flannel/CNI             | ~50MB      | 네트워크 플러그인 (자동 설치) |
| **시스템 합계**         | **~450MB** | k3s는 경량으로 설계됨        |

### 2. 애플리케이션 Pod

| 항목            | 최소 스펙  | 권장 스펙      |
| --------------- | ---------- | -------------- |
| Replicas        | 1개        | 2개 (고가용성) |
| CPU 요청        | 50m        | 100m           |
| CPU 제한        | 200m       | 500m           |
| Memory 요청     | 64Mi       | 128Mi          |
| Memory 제한     | 128Mi      | 256Mi          |
| **실제 사용량** | **~100MB** | **~200MB**     |

### 3. 운영체제 및 기타

| 항목              | 메모리 사용량 |
| ----------------- | ------------- |
| Ubuntu 22.04 LTS  | 200-300MB     |
| 시스템 프로세스   | 100-200MB     |
| containerd (k3s 포함) | ~50MB      |
| **OS 합계**       | **350-550MB** |

### 4. 여유 공간 (안정성)

| 목적                   | 메모리        |
| ---------------------- | ------------- |
| 버퍼/캐시              | 200-300MB     |
| 피크 사용량 대비       | 200-300MB     |
| 업그레이드/재시작 여유 | 200-300MB     |
| **여유 합계**          | **600-900MB** |

## 최소 스펙 추정 (k3s)

### 최소 구성 (k3s 사용)

```
k3s 시스템:         450MB
애플리케이션:        100MB
OS 및 기타:         350MB
여유 공간:          400MB
─────────────────────────
총 필요 메모리:     1,300MB ≈ 1.5GB
```

**결론**: **2GB RAM으로 충분히 실행 가능**합니다 (k3s의 경량 설계 덕분).

### 권장 구성 (안정적 운영)

```
k3s 시스템:         450MB
애플리케이션:        200MB (2개 replica)
OS 및 기타:         500MB
여유 공간:          850MB
─────────────────────────
총 필요 메모리:     2,000MB ≈ 2GB
```

**결론**: **2GB RAM으로 안정적 운영 가능**, 여유를 위해 4GB 권장

## EC2 인스턴스 타입 추천 (k3s)

### 옵션 1: 최소 구성 (비용 절감) ✅ 현재 사용

- **t3.small**: 2 vCPU, **2GB RAM**
- **월 비용**: 약 $15-20 (ap-northeast-2 기준)
- **장점**: 최소 비용, k3s는 2GB로 충분히 실행 가능
- **단점**: 여유 공간이 적어 피크 시 불안정할 수 있음

### 옵션 2: 권장 구성 (안정적)

- **t3.medium**: 2 vCPU, **4GB RAM**
- **월 비용**: 약 $30-35 (ap-northeast-2 기준)
- **장점**: 충분한 여유 공간, 안정적 운영
- **단점**: 비용이 2배

## CPU 요구사항

### 최소 CPU

- **vCPU**: 2개 (t3.small 이상)
- **시스템 컴포넌트**: ~0.5 vCPU
- **애플리케이션**: ~0.2 vCPU (1개 Pod)
- **여유**: ~1.3 vCPU

**결론**: **2 vCPU로 충분**합니다.

## 디스크 요구사항

### 최소 디스크

- **OS**: 8GB
- **Docker 이미지**: 5-10GB
- **Kubernetes 데이터**: 2-5GB
- **애플리케이션 로그**: 1-2GB
- **여유 공간**: 5GB
- **총 필요**: **20-30GB**

**현재 설정**: 20GB (충분)

## 최종 추천 사양 (k3s)

### 최소 스펙 (비용 절감) ✅ 현재 구성

```
인스턴스 타입: t3.small
vCPU: 2개
RAM: 2GB
디스크: 20GB (gp3)
예상 월 비용: $15-20
```

### 권장 스펙 (안정적)

```
인스턴스 타입: t3.medium
vCPU: 2개
RAM: 4GB
디스크: 20GB (gp3)
예상 월 비용: $30-35
```

## 메모리 최적화 팁 (k3s)

### 1. 애플리케이션 최적화

- Replica를 1개로 유지 (고가용성 불필요 시)
- 메모리 요청/제한 최소화 (64Mi/128Mi)
- CPU 요청/제한 최소화 (50m/200m)

### 2. k3s 최적화

- k3s는 이미 경량으로 최적화되어 있음
- 불필요한 기능 비활성화 가능 (예: Traefik, ServiceLB)
- CoreDNS는 자동으로 최적화됨

### 3. Podman 최적화

- Podman은 데몬이 없어 메모리 사용량이 적음
- rootless 실행으로 보안 강화

## 결론 (k3s)

### 현재 t3.small (2GB) 구성

- ✅ k3s는 경량으로 2GB에서도 실행 가능
- ✅ 최소 비용으로 컨테이너 오케스트레이션 실습 가능
- ⚠️ 피크 사용량 시 불안정할 수 있음

### 권장 해결책

1. **현재 구성 유지**: t3.small (2GB) - 최소 비용, 실습 목적에 적합
2. **안정적 운영**: t3.medium (4GB) - 여유 공간 확보

### 비용 비교 (ap-northeast-2 기준)

- t3.small (2GB): ~$15-20/월 ✅ (k3s로 실행 가능)
- t3.medium (4GB): ~$30-35/월 ✅ (안정적 운영)

**최종 권장**: 
- **실습/개발**: **t3.small (2GB)** - 최소 비용
- **프로덕션**: **t3.medium (4GB)** - 안정적 운영
